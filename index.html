<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Home</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --bg:#f8fafc;
  --card:#ffffff;
  --panel:#e0f2fe;
  --text:#0f172a;
  --btn:#93c5fd;
  --btnText:#020617;
  --top1:#60a5fa;
  --top2:#38bdf8;
  --success:#22c55e;
  --danger:#ef4444;
}
.dark{
  --bg:#020617;
  --card:#0f172a;
  --panel:#1e293b;
  --text:#e5e7eb;
  --btn:#334155;
  --btnText:#e5e7eb;
  --top1:#1e293b;
  --top2:#020617;
}
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  transition:.3s;
  overflow-x:hidden;
}

/* LOGIN */
.login{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#60a5fa,#38bdf8)
}
.login-box{
  background:var(--card);
  padding:40px;
  border-radius:20px;
  width:90%;
  max-width:380px;
}
.login-box input{
  width:100%;padding:14px;margin:10px 0;
  border-radius:10px;border:1px solid #cbd5f5;
}
.login-box button{
  width:100%;padding:14px;border:none;
  border-radius:12px;background:#60a5fa;color:white;font-size:18px;
}

/* SIDEBAR */
.sidebar{
  position:fixed;top:0;left:0;height:100%;width:240px;
  background:var(--panel);
  padding:20px;transform:translateX(-100%);
  transition:.3s;z-index:20;
}
.sidebar.show{transform:translateX(0)}
.sidebar button{
  width:100%;padding:12px;margin:8px 0;
  border:none;border-radius:12px;
  background:var(--btn);
  color:var(--btnText);
  font-size:16px;
}

/* DARK TOGGLE */
.toggle{
  margin-top:20px;
  padding:12px;
  border-radius:12px;
  background:var(--btn);
  display:flex;justify-content:space-between;align-items:center;
}

/* OVERLAY */
#overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.4);
  opacity:0;pointer-events:none;
  transition:.3s;z-index:15;
}
#overlay.show{opacity:1;pointer-events:auto}

.hidden{display:none}
.app{min-height:100vh}

/* TOPBAR */
.topbar{
  display:flex;align-items:center;gap:10px;
  padding:14px 16px;
  background:linear-gradient(135deg,var(--top1),var(--top2));
  color:white;
}
.menu,.back{font-size:26px;cursor:pointer}
.topbar h3{flex:1;text-align:center;margin:0}

/* üî• PAGE VISIBILITY FIX (IMPORTANT) */
.page{
  display:none;
  min-height:calc(100vh - 56px);
  padding:20px;
}
.page.active{
  display:block;
}

/* CARDS */
.card{
  background:var(--card);
  padding:22px;border-radius:20px;
  margin-bottom:20px;
}

/* HOME */
.hello-card{
  background:linear-gradient(135deg,#f0f9ff,#e0f2fe);
}
.dark .hello-card{background:#0f172a}

.esp-card{
  display:flex;align-items:center;gap:14px;
  background:linear-gradient(135deg,#ecfeff,#e0f2fe);
}
.dark .esp-card{background:#1e293b}
.esp-icon{font-size:28px}
.online{color:var(--success)}
.offline{color:var(--danger)}

/* LED */
.led-vertical{display:flex;flex-direction:column;gap:14px}
.led-btn{
  padding:18px;border:none;border-radius:18px;
  font-size:17px;font-weight:700;
  background:var(--btn);
  color:var(--btnText);
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="login">
  <div class="login-box">
    <h2>Smart Home</h2>
    <input id="user" placeholder="Username">

    <div style="position:relative">
      <input id="pass" type="password" placeholder="Password">
      <i id="eye" class="fa-solid fa-eye-slash"
         style="position:absolute;right:14px;top:50%;
         transform:translateY(-50%);
         cursor:pointer;color:#64748b"></i>
    </div>

    <button id="loginBtn">Login</button>
  </div>
</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <h2>üè† Smart Home</h2>
  <button onclick="navigate('home')">Home</button>
  <button onclick="navigate('room1')">Room 1</button>
  <button onclick="logout()">Logout</button>

  <div class="toggle">
    <span>üåô Dark Mode</span>
    <input type="checkbox" id="darkToggle">
  </div>
</div>
<div id="overlay"></div>

<!-- APP -->
<div class="app hidden" id="app">
  <div class="topbar">
    <span class="menu" onclick="toggleSidebar()">‚ò∞</span>
    <h3 id="title">Home</h3>
  </div>

  <!-- HOME -->
  <div class="page active" id="home">
    <div class="card hello-card">
      <h2>Hello, Aayush üëã</h2>
      <p>Welcome to your Smart Home</p>
    </div>

    <div class="card esp-card">
      <div class="esp-icon">üì°</div>
      <div id="espStatus">Checking connection...</div>
    </div>
  </div>

  <!-- ROOM 1 -->
  <div class="page" id="room1">
    <div class="card" id="temp">Temperature: -- ¬∞C</div>
    <div class="card">
      <div class="led-vertical" id="ledGrid"></div>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

/* FIREBASE */
const appFb=initializeApp({
  apiKey:"AIzaSyAht7TWN8NlbICl0VbEIuc19Mri7oPlXvc",
  databaseURL:"https://home-automation-89830-default-rtdb.firebaseio.com"
});
const db=getDatabase(appFb);

/* LOGIN */
loginBtn.onclick=()=>{
  if(user.value==="aayush" && pass.value==="Aayush@1982"){
    login.classList.add("hidden");
    app.classList.remove("hidden");
    navigate("home");
    startESPCheck();
  }else alert("Invalid login");
};
window.logout=()=>location.reload();

/* SIDEBAR */
window.toggleSidebar=()=>{
  sidebar.classList.toggle("show");
  overlay.classList.toggle("show");
};
overlay.onclick=()=>toggleSidebar();

/* NAVIGATION */
window.navigate=p=>{
  document.querySelectorAll(".page").forEach(pg=>pg.classList.remove("active"));
  document.getElementById(p).classList.add("active");
  title.innerText=p==="home"?"Home":"Room 1";
  sidebar.classList.remove("show");
  overlay.classList.remove("show");
};

/* ESP32 */
function startESPCheck(){
  setTimeout(()=>{
    get(ref(db,"/status/lastSeen")).then(s=>{
      espStatus.innerHTML = (s.exists() && Date.now()-s.val()<10000)
        ? `<span class="online">‚óè ESP32 ONLINE</span>`
        : `<span class="offline">‚óè ESP32 OFFLINE</span>`;
    });
  },500);
}

/* TEMP */
onValue(ref(db,"/status/temperature"),s=>{
  if(s.exists()) temp.textContent=`Temperature: ${s.val()} ¬∞C`;
});

/* LEDS */
const states=[false,false,false,false];
for(let i=1;i<=4;i++){
  const b=document.createElement("button");
  b.className="led-btn";
  b.onclick=()=>set(ref(db,`/leds/led${i}`),!states[i-1]);
  ledGrid.appendChild(b);
  onValue(ref(db,`/leds/led${i}`),s=>{
    states[i-1]=s.val();
    b.innerText=states[i-1]?`Turn OFF LED ${i}`:`Turn ON LED ${i}`;
  });
}

/* PASSWORD EYE */
eye.onclick=()=>{
  pass.type = pass.type==="password" ? "text" : "password";
  eye.className = pass.type==="password"
    ? "fa-solid fa-eye-slash"
    : "fa-solid fa-eye";
};
</script>

</body>
</html>
